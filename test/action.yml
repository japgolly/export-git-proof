name: 'export-git-proof-test'
description: 'Tests'

# ======================================================================================================================
inputs:

  gist_id:
    description: "id of the gist"
    required: true

# ======================================================================================================================
runs:
  using: 'composite'
  steps:

    - name: Get git log
      shell: bash
      run: |
        git log --stat > /tmp/GIT_LOG.txt
        echo >> /tmp/GIT_LOG.txt

    - name: Read gist
      id: read_gist
      uses: gorgbus/gist-actions@main
      with:
        action: get
        gist_id: ${{ inputs.gist_id }}
        file_name: log.txt

    - name: Compare outputs
      shell: bash
      run: |
        GIT_LOG="$(cat /tmp/GIT_LOG.txt)"
        if [ "$GIT_LOG" != '${{ steps.read_gist.outputs.content }}' ]; then
          echo "Gist contents not as expected."
          echo '${{ steps.read_gist.outputs.content }}' > actual.txt
          echo ==============================================================================================
          diff -u /tmp/GIT_LOG.txt actual.txt
          echo ==============================================================================================
          exit 1
        else
          echo "Confirmed: gist updated successfully."
        fi
